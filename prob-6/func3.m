function dQ = func2(t,Q, emt, Em, El)
%-------------------------------------------------------------------------%
% Calling global variables                                                %
%-------------------------------------------------------------------------%
global k
global lambda
global mu_deep
global mu_mix
global gamma
global ka
global kd
global del_d
global AM
global OM
global kH
global k1
global k2
global alk
global del_a
global C0
%-------------------------------------------------------------------------%
% Calculating H                                                           %
%-------------------------------------------------------------------------%
qu  = Q(2);
b   = k1*(1-qu/alk);
c   = k1*k2*(1 - (2.0*qu)/alk);
a   = 1.0;
H   = (-b - (b^2 - 4*a*c)^(0.5))/(2.0*a);
if H < 0.0
    H = (-b + (b^2 - 4*a*c)^(0.5))/(2.0*a);
end
%-------------------------------------------------------------------------%
% Calculating lambda                                                      %
%-------------------------------------------------------------------------%
lambda  = 1 + k1/H + (k1*k2)/H^2;
%-------------------------------------------------------------------------%
% Sources                                                                 %
%-------------------------------------------------------------------------%
Em      = interp1(emt, Em, t);
El      = interp1(emt, El, t);
%-------------------------------------------------------------------------%
% Sinks                                                                   %
%-------------------------------------------------------------------------%
bio     = 2400*10^15/12;
cstep   = Q(1)./AM.*10^6;
beta    = 0.75;
f       = 1+beta*log(cstep/C0);
%disp(f)
%f       = 1.0;
tau_G   = 50.0;
tau_D   = 50.0;
sink    = f*Q(5)/tau_G - Q(4)/tau_D;
%sink    = f*bio/tau_G - Q(4)/tau_D;
%-------------------------------------------------------------------------%
% Derivatives                                                             %
%-------------------------------------------------------------------------%
d_Qa    = -ka*Q(1) + ka*kH/(del_a*lambda)*Q(2) + Em + El - sink;
d_Qu    = ka*Q(1) - ka*kH/(del_a*lambda)*Q(2) - kd*Q(2) + kd/del_d *Q(3);
d_Ql    = kd*Q(2) -  kd/del_d*Q(3);
d_M     = sink - El;
d_C     = -El;
dQ      = [d_Qa; d_Qu; d_Ql; d_M; d_C]; 

end
