clear all
close all
clc
%-------------------------------------------------------------------------%
% Reading in data                                                         %
%-------------------------------------------------------------------------%
E                   = xlsread('../data/EmissionsProj.xlsx', 'B2:B265');
E                   = E*10^15/12;
land_emissions      = xlsread('../data/EmissionsProj.xlsx', 'C2:C265');
emissions_yrs       = xlsread('../data/EmissionsProj.xlsx', 'A2:A265');
temp_data           = xlsread('../data/TempProj.xlsx', 'B2:B170');
temp_yrs            = xlsread('../data/TempProj.xlsx', 'A2:A170');
CO2_data            = xlsread('../data/CO2_proj.xlsx', 'B2:B106');
CO2_yrs             = xlsread('../data/CO2_proj.xlsx', 'A2:A106');
%-------------------------------------------------------------------------%
% Temperature variables                                                   %
%-------------------------------------------------------------------------%
k       = 5.35*3.154e+07;
lambda  = 1.2*3.154e+07;
mu_deep = 6.307e+09;
mu_mix  = 3.154e+08;
gamma   = 1.2*3.154e+07;
%-------------------------------------------------------------------------%
% CO2 variables                                                           %
%-------------------------------------------------------------------------%
ka      = 0.2;
kd      = 0.05;
del_d   = 50.0;
AM      = 1.77e+20;
OM      = 7.8e+22;
kH      = 1.23e+3;
k1      = 1.44e-08;
k2      = 8.154e-12;
alk     = 767e+15/12.0;
del_a   = OM/(AM*(1+del_d));
%-------------------------------------------------------------------------%
% Temperature initial conditions                                          %
%-------------------------------------------------------------------------%
t       = linspace(1751,2014, length(emissions_yrs));  
dt      = abs(t(2)-t(1));
T_mix   = zeros(1, length(t));
T_deep  = zeros(1, length(t));
%-------------------------------------------------------------------------%
% CO2 initial conditions                                                  %
%-------------------------------------------------------------------------%
Qa      = zeros(1, length(t));
Qu      = zeros(1, length(t));
Ql      = zeros(1, length(t));
temp    = zeros(1, length(t));
Qa(1)   = 590*10^15/12;
Qu(1)   = 713*10^15/12;
Ql(1)   = 35658*10^15/12;
count   = 1505;
%-------------------------------------------------------------------------%
% Time loop                                                               %
%-------------------------------------------------------------------------%
for i = 1:length(t)-1
    %---------------------------------------------------------------------%
    % Calculating H                                                       %
    %---------------------------------------------------------------------%
    qu  = Qu(i);
    b   = k1*(1-qu/alk);
    c   = k1*k2*(1 - (2.0*qu)/alk);
    a   = 1.0;
    H   = (-b - (b^2 - 4*a*c)^(0.5))/(2.0*a);
    if H < 0.0
        H = (-b + (b^2 - 4*a*c)^(0.5))/(2.0*a);
    end
    %---------------------------------------------------------------------%
    % Calculating lambda                                                  %
    %---------------------------------------------------------------------%
    lambda  = 1 + k1/H + (k1*k2)/H^2;
    %---------------------------------------------------------------------%
    % Derivatives                                                         %
    %---------------------------------------------------------------------%
    d_Qa    = -ka*Qa(i) + ka*kH/(del_a*lambda)*Qu(i) + E(i);
    d_Qu    = ka*Qu(i) - ka*kH/(del_a*lambda)*Qu(i) - kd*Qu(i) + kd/del_d *Ql(i);
    d_Ql    = kd*Qu(i) -  kd/del_d*Ql(i);

    Qa(i+1) = Qa(i) + dt*d_Qa; 
    Qu(i+1) = Qu(i) + dt*d_Qu; 
    Ql(i+1) = Ql(i) + dt*d_Ql; 
    count   = count + 1;
    temp(i) = H;
end
                      
Qa  = Qa/AM*10^6;
Qu  = Qu/AM*10^6;
Ql  = Ql/AM*10^6;
hold on
%plot(t, temp)
plot(t, Qa, 'r')
plot(CO2_yrs, CO2_data, 'b')

